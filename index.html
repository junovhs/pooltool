<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Content Hub</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        nav { background: #f0f0f0; padding: 10px; }
        nav ul { list-style-type: none; padding: 0; }
        nav ul li { display: inline; margin-right: 10px; }
        #content { margin-top: 20px; }
    </style>
</head>
<body>
    <nav id="navbar"></nav>
    <div id="content"></div>

    <script>
        const pages = [];
        const navbar = document.getElementById('navbar');
        const content = document.getElementById('content');

        window.addEventListener('message', function(event) {
            if (event.data.type === 'PAGE_ANNOUNCEMENT') {
                if (!pages.includes(event.data.page)) {
                    pages.push(event.data.page);
                    updateNavigation();
                }
            }
        });

        function updateNavigation() {
            const navItems = pages.map(page => 
                `<li><a href="#${page}">${formatPageName(page)}</a></li>`
            ).join('');
            navbar.innerHTML = `<ul>${navItems}</ul>`;
        }

        function formatPageName(page) {
            return page.replace('.html', '').split('_').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function loadPage(page) {
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = `pages/${page}`;
            document.body.appendChild(iframe);

            iframe.onload = function() {
                content.innerHTML = iframe.contentDocument.body.innerHTML;
                document.body.removeChild(iframe);
            };
        }

        window.addEventListener('hashchange', () => {
            const page = location.hash.substring(1);
            if (page) loadPage(page);
        });

        navbar.addEventListener('click', (event) => {
            if (event.target.tagName === 'A') {
                event.preventDefault();
                const page = event.target.getAttribute('href').substring(1);
                location.hash = page;
            }
        });

        // Start the discovery process
        function discoverPages() {
            fetch('pages/')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const links = doc.querySelectorAll('a');
                    links.forEach(link => {
                        if (link.href.endsWith('.html')) {
                            const iframe = document.createElement('iframe');
                            iframe.style.display = 'none';
                            iframe.src = link.href;
                            document.body.appendChild(iframe);
                        }
                    });
                })
                .catch(error => console.error('Error discovering pages:', error));
        }

        discoverPages();
    </script>
</body>
</html>
