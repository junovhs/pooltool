<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enhanced Deals Parser Tool with Fuzzy Matching</title>
  <style>
    :root { --primary-color:#3498db; --secondary-color:#2c3e50; --accent-color:#e74c3c; --success-color:#2ecc71; --warning-color:#f39c12; --light-color:#ecf0f1; --dark-color:#34495e; --shadow:0 4px 6px rgba(0,0,0,0.1); --border-radius:8px; }
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:20px; line-height:1.6; color:var(--dark-color); background:#f5f7fa; }
    .container { max-width:1200px; margin:0 auto; padding:20px; background:#fff; border-radius:var(--border-radius); box-shadow:var(--shadow); }
    header { margin-bottom:30px; padding-bottom:15px; border-bottom:2px solid var(--light-color); }
    h1 { color:var(--primary-color); margin-top:0; font-size:2.2rem; }
    textarea { width:100%; max-width:100%; font-family:'Courier New', monospace; font-size:14px; padding:15px; border:1px solid #ddd; border-radius:var(--border-radius); min-height:200px; transition:border .3s; box-shadow:inset 0 1px 3px rgba(0,0,0,.1); }
    textarea:focus { outline:none; border-color:var(--primary-color); box-shadow:0 0 0 3px rgba(52,152,219,.2); }
    .button-group { display:flex; gap:10px; margin:15px 0; }
    button { padding:10px 20px; font-size:16px; cursor:pointer; background:var(--primary-color); color:#fff; border:none; border-radius:var(--border-radius); transition:all .3s; box-shadow:var(--shadow); }
    button:hover { background:#2980b9; transform:translateY(-2px); }
    button:active { transform:translateY(0); }
    button.secondary { background:var(--light-color); color:var(--dark-color); }
    button.secondary:hover { background:#d5dbdb; }
    .vendor { margin-top:25px; padding:15px; border-radius:var(--border-radius); background:#fff; box-shadow:var(--shadow); border-left:5px solid var(--primary-color); transition:transform .2s; animation:fadeIn .3s ease-out; }
    .vendor:hover { transform:translateY(-3px); }
    .vendor h2 { border-bottom:2px solid #eee; padding-bottom:10px; margin:0 0 15px 0; color:var(--secondary-color); display:flex; align-items:center; }
    .unknown-supplier { border-left:5px solid var(--accent-color); }
    .unknown-supplier h2, .unknown-supplier .deal { color:var(--accent-color); }
    .deal { position:relative; margin-left:20px; margin-bottom:15px; padding:10px; background:#f8f9fa; border-radius:var(--border-radius); border-left:3px solid var(--light-color); transition:opacity .3s, background-color .3s; }
    .deal:hover .remove-btn { opacity:1; }
    .deal.removed { opacity:.5; text-decoration:line-through; }
    .remove-btn { position:absolute; top:5px; right:5px; width:24px; height:24px; border-radius:50%; background:#e74c3c; color:#fff; font-weight:bold; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; opacity:0; transition:opacity .2s; }
    .exclusive { color:#fff; background:var(--accent-color); font-weight:bold; padding:3px 8px; border-radius:4px; margin-right:8px; font-size:12px; display:inline-block; }
    .deal-text { display:inline-block; vertical-align:middle; }
    .deal-text strong { color:var(--accent-color); }
    .expiry { color:#555; margin-left:8px; }
    .date-pill { display:inline-block; border-radius:20px; padding:5px 10px; font-weight:bold; margin:2px; font-size:13px; box-shadow:0 2px 4px rgba(0,0,0,.1); }
    .expiry-pill { background:var(--accent-color); color:#fff; }
    .start-pill { background:var(--success-color); color:#fff; }
    #controls { margin:20px 0; display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .controls-label { font-weight:bold; margin-right:10px; color:var(--secondary-color); }
    .filter-pill { display:inline-block; border-radius:20px; padding:6px 12px; background:var(--light-color); color:var(--dark-color); font-weight:bold; cursor:pointer; transition:all .3s; box-shadow:0 2px 4px rgba(0,0,0,.1); }
    .filter-pill:hover { transform:translateY(-2px); box-shadow:0 4px 8px rgba(0,0,0,.1); }
    .filter-pill.active { background:var(--primary-color); color:#fff; }
    .filters-container { display:flex; flex-direction:column; gap:15px; margin:20px 0; }
    #supplier-controls, #exclusive-controls { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    @media (max-width:768px) { .container{padding:15px;} button{padding:8px 15px;font-size:14px;} .vendor{padding:12px;} .filters-container{gap:10px;} }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px);} to { opacity:1; transform:translateY(0);} }
    .tooltip { position:relative; display:inline-block; }
    .tooltip .tooltip-text { visibility:hidden; width:200px; background:var(--dark-color); color:#fff; text-align:center; border-radius:6px; padding:10px; position:absolute; z-index:1; bottom:125%; left:50%; margin-left:-100px; opacity:0; transition:opacity .3s; font-size:14px; box-shadow:var(--shadow); }
    .tooltip:hover .tooltip-text { visibility:visible; opacity:1; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Enhanced Deals Parser Tool with Fuzzy Matching</h1>
      <p>Paste your deals text in the box below and click "Parse Deals". Format: v[Vendor], d[Deal], ed[Exclusive Deal].</p>
    </header>

    <textarea id="inputText" rows="20" placeholder="Paste your deals text here..."></textarea>

    <div class="button-group">
      <button onclick="parseDeals()">Parse Deals</button>
      <button onclick="copyFormattedList()" class="secondary">Copy List</button>
      <button onclick="resetRemovedDeals()" class="secondary">Show All</button>
      <div class="tooltip">
        <button class="secondary">Help</button>
        <span class="tooltip-text">
          Format your deals as:<br>
          vVendor Name<br>
          dDeal description: MM/DD/YYYY<br>
          edExclusive deal: MM/DD/YYYY
        </span>
      </div>
    </div>

    <div class="filters-container">
      <div id="controls"><span class="controls-label">Filter by expiry:</span></div>
      <div id="supplier-controls"><span class="controls-label">Filter by supplier:</span></div>
      <div id="exclusive-controls">
        <span class="controls-label">Show deals:</span>
        <span class="filter-pill active" onclick="filterByExclusive('All')">All Deals</span>
        <span class="filter-pill" onclick="filterByExclusive('Exclusive')">Exclusive Only</span>
        <span class="filter-pill" onclick="filterByExclusive('Regular')">Regular Only</span>
      </div>
    </div>

    <div id="result"></div>
  </div>

  <script>
    const knownSuppliers = [
      "Abercrombie & Kent","Adventures by Disney","African Travel","Ama Waterways","American Airline Vacations","American Cruise Line","Aulani, A Disney Resort & Spa","Avalon Waterways","Azamara","Beaches","BlueSky Tours","Breathless","Carnival","Celebrity Cruises","CIE Tours","Club Med","Collette","CroisiEurope","Crystal Cruises","Cunard","Delta Vacations","Disney Cruise Line","Disneyland","DisneyWorld","Dreams","El Dorado Spa Resorts & Hotels","Emerald Cruises","Excellence Resorts","Explora Journeys","Four Seasons Yachts","Funjet","G Adventures","Globus Journeys","Great Safaris","Hard Rock Hotels","Holland America Line","Hurtigruten","Iberostar Hotels & Resorts","Karisma Hotels & Resorts","Lindblad Expeditions & National Geographic","MSC Cruises","Norwegian","Oceania Cruises","Outrigger Hotels & Resorts","Palace Resorts","Paul Gauguin Cruises","Ponant","Princess","Project Expedition","Regent Seven Seas Cruises","Ritz-Carlton Yacht Collection","RIU Hotels & Resorts","Riverside Cruises","Riviera River Cruises","Rocky Mountaineer","Royal Caribbean","Sandals","Scenic Eclipse Ocean Voyages","Scenic River","Seabourn","Secrets","Shore Excursions Group","Silversea","Southwest Vacations","Star Clippers","Tauck Cruises","Tauck Tours","TourSales.com","Trafalgar","UnCruise Adventures","Uniworld","United Vacations","Viking Ocean","Viking River","Viator","Virgin Voyages","Villas of Distinction","Zoëtry Wellness & Spa Resorts"
    ];

    const aliasMapping = {
      "american airlines vacations":"American Airline Vacations","american airline vacations":"American Airline Vacations","american airlnes vacations":"American Airline Vacations",
      "royal":"Royal Caribbean","rccl":"Royal Caribbean","rcc":"Royal Caribbean","royal caribbean":"Royal Caribbean",
      "norwegian":"Norwegian","norwegian cruise":"Norwegian","norwegian cruise line":"Norwegian","ncl":"Norwegian",
      "disney cruise":"Disney Cruise Line","disney cruises":"Disney Cruise Line","disney cruise line":"Disney Cruise Line",
      "celebrity":"Celebrity Cruises","celebrity cruises":"Celebrity Cruises",
      "virgin":"Virgin Voyages","virgin voyages":"Virgin Voyages","virgin cruise":"Virgin Voyages",
      "holland":"Holland America Line","holland america":"Holland America Line","holland america line":"Holland America Line",
      "princess":"Princess","princess cruises":"Princess",
      "carnival":"Carnival","carnival cruise":"Carnival","carnival cruises":"Carnival",
      "msc":"MSC Cruises","msc cruises":"MSC Cruises",
      "viking":"Viking Ocean","viking ocean":"Viking Ocean",
      "american cruise":"American Cruise Line","american cruise line":"American Cruise Line",
      "atlas":"Atlas Ocean Voyages","atlas ocean":"Atlas Ocean Voyages","atlas ocean voyages":"Atlas Ocean Voyages",
      "azamara":"Azamara","crystal":"Crystal Cruises","crystal cruises":"Crystal Cruises","cunard":"Cunard","cunard cruises":"Cunard",
      "emerald":"Emerald Cruises","emerald cruises":"Emerald Cruises",
      "explora":"Explora Journeys","explora journeys":"Explora Journeys",
      "four seasons":"Four Seasons Yachts","four seasons yachts":"Four Seasons Yachts","four seasons yacht":"Four Seasons Yachts",
      "funjet":"Funjet","fun jet":"Funjet",
      "oceania":"Oceania Cruises","oceania cruises":"Oceania Cruises",
      "paul gauguin":"Paul Gauguin Cruises","paul gauguin cruises":"Paul Gauguin Cruises",
      "ponant":"Ponant","ponant cruises":"Ponant",
      "regent":"Regent Seven Seas Cruises","regent seven seas":"Regent Seven Seas Cruises","seven seas":"Regent Seven Seas Cruises",
      "ritz-carlton":"Ritz-Carlton Yacht Collection","ritz carlton":"Ritz-Carlton Yacht Collection","ritz-carlton yacht":"Ritz-Carlton Yacht Collection",
      "seabourn":"Seabourn","seabourn cruises":"Seabourn","silversea":"Silversea","silversea cruises":"Silversea",
      "star clippers":"Star Clippers","star clipper":"Star Clippers",
      "tauck":"Tauck Cruises","tauck cruises":"Tauck Cruises",
      "windstar":"Windstar",
      "viking river":"Viking River","viking river cruises":"Viking River",
      "avalon":"Avalon Waterways","avalon waterways":"Avalon Waterways",
      "ama":"Ama Waterways","ama waterways":"Ama Waterways",
      "croisieurope":"CroisiEurope","croisi europe":"CroisiEurope","croisi-europe":"CroisiEurope",
      "riverside":"Riverside Cruises","riverside cruises":"Riverside Cruises",
      "riviera":"Riviera River Cruises","riviera river":"Riviera River Cruises","riviera river cruises":"Riviera River Cruises",
      "tauck tours":"Tauck Tours","tauck tour":"Tauck Tours",
      "uniworld":"Uniworld","uniworld cruises":"Uniworld",
      "scenic river":"Scenic River",
      "lindblad":"Lindblad Expeditions & National Geographic","lindblad expeditions":"Lindblad Expeditions & National Geographic","national geographic":"Lindblad Expeditions & National Geographic",
      "hurtigruten":"Hurtigruten","hurtigruten cruises":"Hurtigruten",
      "adventures by disney":"Adventures by Disney","disneyland":"Disneyland","disney land":"Disneyland","disneyworld":"DisneyWorld","disney world":"DisneyWorld",
      "aulani":"Aulani, A Disney Resort & Spa","a disney resort":"Aulani, A Disney Resort & Spa","aulani, a disney resort & spa":"Aulani, A Disney Resort & Spa",
      "sandals":"Sandals","beaches":"Beaches","breathless":"Breathless","club med":"Club Med","clubmed":"Club Med",
      "el dorado":"El Dorado Spa Resorts & Hotels","el dorado spa":"El Dorado Spa Resorts & Hotels",
      "dreams":"Dreams","dreams resorts":"Dreams","excellence":"Excellence Resorts","excellence resorts":"Excellence Resorts",
      "hard rock":"Hard Rock Hotels","hard rock hotels":"Hard Rock Hotels","iberostar":"Iberostar Hotels & Resorts","iberostar hotels":"Iberostar Hotels & Resorts",
      "karisma":"Karisma Hotels & Resorts",
      "outrigger":"Outrigger Hotels & Resorts","outrigger hotels":"Outrigger Hotels & Resorts",
      "palace":"Palace Resorts","palace resorts":"Palace Resorts",
      "riu":"RIU Hotels & Resorts","riu hotels":"RIU Hotels & Resorts",
      "secrets":"Secrets",
      "delta":"Delta Vacations","delta vacations":"Delta Vacations",
      "southwest":"Southwest Vacations","southwest vacations":"Southwest Vacations",
      "united":"United Vacations","united vacations":"United Vacations",
      "villas":"Villas of Distinction","villas of distinction":"Villas of Distinction",
      "zoëtry":"Zoëtry Wellness & Spa Resorts","zoeetry":"Zoëtry Wellness & Spa Resorts",
      "bluesky":"BlueSky Tours","blue sky tours":"BlueSky Tours",
      "cie":"CIE Tours","cie tours":"CIE Tours",
      "collette":"Collette","great safaris":"Great Safaris",
      "project expedition":"Project Expedition","project expeditions":"Project Expedition",
      "shore excursions":"Shore Excursions Group","shore excursions group":"Shore Excursions Group",
      "toursales":"TourSales.com","tour sales":"TourSales.com",
      "trafalgar":"Trafalgar"
    };

    function normalizeString(str){ return str.toLowerCase().trim(); }

    function levenshtein(a,b){
      if(a.length===0) return b.length; if(b.length===0) return a.length;
      let m=[]; for(let i=0;i<=b.length;i++) m[i]=[i]; for(let j=0;j<=a.length;j++) m[0][j]=j;
      for(let i=1;i<=b.length;i++){ for(let j=1;j<=a.length;j++){
        m[i][j]=(b.charAt(i-1)===a.charAt(j-1))?m[i-1][j-1]:Math.min(m[i-1][j-1]+1,Math.min(m[i][j-1]+1,m[i-1][j]+1));
      }} return m[b.length][a.length];
    }

    function similarity(a,b){ const d=levenshtein(a,b); const L=Math.max(a.length,b.length); return L===0?1:(L-d)/L; }

    function findSupplierMatch(vendorName){
      const n=normalizeString(vendorName);
      for(const alias in aliasMapping){ if(n===alias || n.includes(alias)) return aliasMapping[alias]; }
      let best="", score=0;
      for(const s of knownSuppliers){
        const ns=normalizeString(s);
        if(n.includes(ns) || ns.includes(n)) return s;
        const r=similarity(n,ns);
        if(r>score){ score=r; best=s; }
      }
      return score>0.6?best:null;
    }

    function formatDate(mm,dd,yyyy){ mm=mm.toString().padStart(2,'0'); dd=dd.toString().padStart(2,'0'); return `${mm}/${dd}/${yyyy}`; }

    function boldAmounts(text){
      return text.replace(/(\$\d+(?:,\d{3})*(?:\.\d+)?)/g,'<strong>$1</strong>').replace(/(\d+%)/g,'<strong>$1</strong>');
    }

    function normalizeYear(dateStr){
      return dateStr.replace(/(\d{1,2}\/\d{1,2})\/(\d{2})(?!\d)/g,(m,md,yy)=>{
        const y=parseInt(yy,10); const full=(y>=0 && y<=79)?2000+y:1900+y; return `${md}/${full}`;
      });
    }

    function parseExpiry(expiryText){
      if(!expiryText) return { html:"", expiry:"" };
      expiryText=expiryText.trim().replace(/[.,]$/,"");
      const lower=expiryText.toLowerCase();
      if(lower.includes("today")){
        const t=new Date(); const f=formatDate(t.getMonth()+1,t.getDate(),t.getFullYear());
        return { html:`<span class="date-pill expiry-pill">${f}</span>`, expiry:f };
      }
      expiryText=normalizeYear(expiryText);
      const datePattern=/(\d{1,2}\/\d{1,2}\/\d{4})/g;
      const matches=expiryText.match(datePattern);
      if(matches){
        if(matches.length===1){
          const [m,d,y]=matches[0].split('/');
          const f=formatDate(m,d,y);
          return { html:`<span class="date-pill expiry-pill">${f}</span>`, expiry:f };
        } else {
          const [m1,d1,y1]=matches[0].split('/');
          const [m2,d2,y2]=matches[matches.length-1].split('/');
          const fs=formatDate(m1,d1,y1); const fe=formatDate(m2,d2,y2);
          return { html:`<span class="date-pill start-pill">${fs}</span> <span class="date-pill expiry-pill">${fe}</span>`, expiry:fe };
        }
      }
      return { html:expiryText, expiry:"" };
    }

    let allDeals=[];

    function parseDeals(){
      const input=document.getElementById("inputText").value;
      const lines=input.split('\n');
      let resultHTML=""; allDeals=[]; let currentVendor=""; let vendorKnown=true;

      lines.forEach(line=>{
        line=line.trim(); if(!line) return;

        if(line.startsWith("v")){
          if(currentVendor){ resultHTML+="</div>"; }
          let vendorName=line.slice(1).trim();
          if(vendorName.endsWith(":")) vendorName=vendorName.slice(0,-1).trim();
          const match=findSupplierMatch(vendorName);
          currentVendor=match?match:vendorName; vendorKnown=!!match;
          resultHTML+=`<div class="vendor ${vendorKnown?"":"unknown-supplier"}"><h2>${currentVendor}</h2>`;
        }
        else if(line.startsWith("d") || line.startsWith("ed")){
          let isExclusive=false;
          if(line.startsWith("ed")){ isExclusive=true; line=line.slice(2).trim(); }
          else { line=line.slice(1).trim(); }

          let dealText=line; let expiryPortion="";
          const colonIndex=line.lastIndexOf(":");
          if(colonIndex!==-1 && colonIndex<line.length-1){
            dealText=line.substring(0,colonIndex).trim();
            expiryPortion=line.substring(colonIndex+1).trim();
          }
          if(!expiryPortion){
            const keywordMatch=/(Ends|Until|Expires)\s+(.+)/i.exec(line);
            if(keywordMatch){ dealText=line.substring(0,keywordMatch.index).trim(); expiryPortion=keywordMatch[2].trim(); }
          }

          dealText=boldAmounts(dealText);
          const parsedExpiry=parseExpiry(expiryPortion);

          resultHTML+=`<div class="deal" data-expiry="${parsedExpiry.expiry}">`;
          if(isExclusive){ resultHTML+=`<span class="exclusive">EXCLUSIVE</span>`; }
          resultHTML+=`<span class="deal-text">${dealText}</span>`;
          if(parsedExpiry.html){ resultHTML+=` <span class="expiry">${parsedExpiry.html}</span>`; }
          resultHTML+=`</div>`;

          allDeals.push({ vendor:currentVendor, expiry:parsedExpiry.expiry, exclusive:isExclusive, element:null });
        }
      });

      if(currentVendor){ resultHTML+="</div>"; }
      document.getElementById("result").innerHTML=resultHTML;

      document.querySelectorAll("#result .deal").forEach((dealEl,i)=>{ if(allDeals[i]) allDeals[i].element=dealEl; });

      generateControls();
      document.querySelectorAll('.vendor').forEach((v,i)=>{ v.style.animationDelay=`${i*0.05}s`; });
      addRemoveButtonsToDeals();
    }

    function generateControls(){
      const controlsDiv=document.getElementById("controls");
      const supplierControlsDiv=document.getElementById("supplier-controls");
      controlsDiv.innerHTML="<span class='controls-label'>Filter by expiry:</span>";
      supplierControlsDiv.innerHTML="<span class='controls-label'>Filter by supplier:</span>";

      const expirySet=new Set();
      document.querySelectorAll(".deal").forEach(d=>{ const e=d.getAttribute("data-expiry"); if(e) expirySet.add(e); });

      const allPill=document.createElement("span");
      allPill.className="filter-pill active"; allPill.textContent="All";
      allPill.onclick=()=>filterDeals("All",allPill);
      controlsDiv.appendChild(allPill);

      Array.from(expirySet).sort((a,b)=>{
        const [am,ad,ay]=a.split('/').map(Number);
        const [bm,bd,by]=b.split('/').map(Number);
        return new Date(ay,am-1,ad)-new Date(by,bm-1,bd);
      }).forEach(date=>{
        const pill=document.createElement("span");
        pill.className="filter-pill"; pill.textContent=date;
        pill.onclick=()=>filterDeals(date,pill);
        controlsDiv.appendChild(pill);
      });

      const supplierSet=new Set();
      document.querySelectorAll(".vendor h2").forEach(h=>supplierSet.add(h.textContent));

      const allSup=document.createElement("span");
      allSup.className="filter-pill active"; allSup.textContent="All";
      allSup.onclick=()=>{
        document.querySelectorAll("#supplier-controls .filter-pill").forEach(p=>p.classList.remove("active"));
        allSup.classList.add("active"); filterBySupplier("All");
      };
      supplierControlsDiv.appendChild(allSup);

      Array.from(supplierSet).sort().forEach(s=>{
        const pill=document.createElement("span");
        pill.className="filter-pill"; pill.textContent=s;
        pill.onclick=()=>{
          document.querySelectorAll("#supplier-controls .filter-pill").forEach(p=>p.classList.remove("active"));
          pill.classList.add("active"); filterBySupplier(s);
        };
        supplierControlsDiv.appendChild(pill);
      });
    }

    function filterDeals(val, activePill){
      document.querySelectorAll("#controls .filter-pill").forEach(p=>p.classList.remove("active"));
      if(activePill) activePill.classList.add("active");
      const deals=document.querySelectorAll(".deal");
      const visible=new Set();
      deals.forEach(d=>{
        if(val==="All" || d.getAttribute("data-expiry")===val){
          d.style.display=""; const v=d.closest('.vendor'); if(v) visible.add(v);
        } else { d.style.display="none"; }
      });
      if(val!=="All"){
        document.querySelectorAll('.vendor').forEach(v=>{ v.style.display=visible.has(v)?"":"none"; });
      } else { document.querySelectorAll('.vendor').forEach(v=>v.style.display=""); }
    }

    function filterBySupplier(val){
      const deals=document.querySelectorAll(".deal");
      const vendors=document.querySelectorAll(".vendor");
      deals.forEach(d=>d.style.display="");
      vendors.forEach(v=>{
        if(val==="All") v.style.display="";
        else v.style.display=(v.querySelector("h2").textContent===val)?"":"none";
      });
    }

    function filterByExclusive(mode){
      if(mode==='All'){ document.querySelectorAll('.deal').forEach(d=>d.style.display=''); }
      else {
        document.querySelectorAll('.deal').forEach(d=>{
          const has=d.querySelector('.exclusive')!==null;
          const show=(mode==='Exclusive' && has) || (mode==='Regular' && !has);
          d.style.display=show?'':'none';
        });
      }
      document.querySelectorAll('.vendor').forEach(v=>{
        const any=Array.from(v.querySelectorAll('.deal')).some(d=>d.style.display!=='none');
        v.style.display=any?'':'none';
      });
    }

    function addRemoveButtonsToDeals(){
      document.querySelectorAll('.deal').forEach(deal=>{
        if(!deal.querySelector('.remove-btn')){
          const btn=document.createElement('button');
          btn.className='remove-btn'; btn.innerHTML='×'; btn.title='Remove this deal';
          btn.onclick=(e)=>{ e.stopPropagation(); removeDeal(deal); };
          deal.appendChild(btn);
        }
      });
    }

    function removeDeal(deal){
      deal.classList.add('removed');
      deal.style.opacity='0.5';
      deal.style.textDecoration='line-through';
      const vendor=deal.closest('.vendor');
      const hasVisible=Array.from(vendor.querySelectorAll('.deal')).some(d=>!d.classList.contains('removed'));
      if(!hasVisible) vendor.style.opacity='0.5';
    }

    function resetRemovedDeals(){
      document.querySelectorAll('.deal.removed').forEach(d=>{
        d.classList.remove('removed'); d.style.opacity=''; d.style.textDecoration='';
      });
      document.querySelectorAll('.vendor').forEach(v=>v.style.opacity='');
    }

    function formatDealsForClipboard(){
      let out='';
      document.querySelectorAll('.vendor').forEach(v=>{
        if(v.style.display==='none') return;
        const vendorName=v.querySelector('h2').textContent;
        const hasVisible=Array.from(v.querySelectorAll('.deal')).some(d=>d.style.display!=='none' && !d.classList.contains('removed'));
        if(!hasVisible) return;
        out+=`v\t${vendorName}:\n`;
        v.querySelectorAll('.deal').forEach(d=>{
          if(d.style.display==='none' || d.classList.contains('removed')) return;
          let line=''; const isEx=d.querySelector('.exclusive')!==null;
          line+=isEx?'ed\t':'d\t';
          line+=d.querySelector('.deal-text').textContent;
          const expiry=d.querySelector('.expiry');
          if(expiry){
            line+=': ';
            const pills=expiry.querySelectorAll('.date-pill');
            if(pills.length){ line+=Array.from(pills).map(p=>p.textContent).join('-'); }
            else { line+=expiry.textContent; }
          }
          out+=`${line}\n`;
        });
      });
      return out;
    }

    function copyFormattedList(){
      const text=formatDealsForClipboard();
      navigator.clipboard.writeText(text).then(()=>{
        const toast=document.createElement('div');
        toast.textContent='Copied to clipboard!';
        toast.style.position='fixed'; toast.style.bottom='20px'; toast.style.left='50%';
        toast.style.transform='translateX(-50%)'; toast.style.padding='10px 20px';
        toast.style.background='rgba(0,0,0,0.7)'; toast.style.color='#fff';
        toast.style.borderRadius='4px'; toast.style.zIndex='1000';
        document.body.appendChild(toast);
        setTimeout(()=>{ toast.style.opacity='0'; toast.style.transition='opacity .5s'; setTimeout(()=>document.body.removeChild(toast),500); },2000);
      }).catch(err=>alert("Copy failed: "+err));
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const ta=document.getElementById('inputText');
      if(!ta.value){
        ta.placeholder=`Example format:
vRoyal Caribbean
dSave up to $150 on select cruises: 12/31/2025
edSpecial: Buy One Get One 50% off, plus kids sail free: 01/01/2025 - 12/31/2025
vCarnival
dFree room upgrades on select sailings: 11/30/2025`;
      }
    });
  </script>
</body>
</html>
