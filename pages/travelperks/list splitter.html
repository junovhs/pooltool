<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Split Marketing Sources</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 300px; padding: 10px; font-family: monospace; font-size: 14px; box-sizing: border-box; margin-top: 10px; }
        button { padding: 10px 20px; font-size: 16px; margin-top: 10px; cursor: pointer; }
        .format-selector { margin-bottom: 10px; }
        .format-selector label { margin-right: 15px; cursor: pointer; }
        .tables { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 30px; }
        .table-container { display: flex; flex-direction: column; } /* For table + button */
        table { border-collapse: collapse; width: 100%; max-width: 600px; margin-bottom: 0px; /* Adjusted margin */ }
        th, td { border: 1px solid #cccccc; padding: 8px 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        caption { caption-side: top; font-weight: bold; margin-bottom: 5px; font-size: 18px; }
        .copy-button-container { margin-top: 5px; margin-bottom: 20px; } /* Container for copy button */
        @media (max-width: 650px) { .tables { flex-direction: column; } table { max-width: 100%; } }
    </style>
</head>
<body>

    <h1>Split Marketing Sources</h1>
    <p>Select input format, paste data, click Process. Check console (F12) for details.</p>

    <div class="format-selector">
        <strong>Select Input Format:</strong><br>
        <label>
            <input type="radio" name="inputFormat" value="ftp" checked> Pivot Table Format (e.g., <code>SourceKey 123</code>)
        </label>
        <br>
        <label>
            <input type="radio" name="inputFormat" value="cc"> Constant Contact Format (e.g., <code>Mktg Source: SourceKey 1,234 ...</code>)
        </label>
    </div>

    <textarea id="inputData" placeholder="Paste your raw list here..."></textarea>
    <br>
    <button onclick="processData()">Process</button>

    <div class="tables">
        <div class="table-container">
            <table id="otherMktgTable">
                <caption>OTHER MKTGSOURCES</caption>
                <thead><tr><th>Source</th><th>Count</th></tr></thead>
                <tbody></tbody>
            </table>
            <div class="copy-button-container">
                <button id="copyOtherMktg" onclick="copyTableToClipboard('otherMktgTable', this)">Copy OTHER MKTGSOURCES</button>
            </div>
        </div>
        <div class="table-container">
            <table id="mainMktgTable">
                <caption>Main Marketing Sources</caption>
                <thead><tr><th>Source</th><th>Count</th></tr></thead>
                <tbody></tbody>
            </table>
            <div class="copy-button-container">
                <button id="copyMainMktg" onclick="copyTableToClipboard('mainMktgTable', this)">Copy Main Marketing Sources</button>
            </div>
        </div>
    </div>

    <script>
        function processData() {
            console.clear();
            console.log("Processing data...");

            const rawInput = document.getElementById('inputData').value.trim();
            if (!rawInput) { alert('Please paste the raw list.'); return; }

            const selectedFormat = document.querySelector('input[name="inputFormat"]:checked');
            if (!selectedFormat) { alert('Please select an input format.'); return; }
            const formatType = selectedFormat.value;
            console.log(`Selected format: ${formatType.toUpperCase()}`);

            const lines = rawInput.split('\n');
            const data = {}; // Stores data with keys EXACTLY as parsed from input

            const ccRegex = /^Mktg Source:\s*(\S+)\s+([\d,]+).*$/;
            const ftpRegex = /^(\S+)\s+(\d+)\s*$/; // Allows trailing spaces

            lines.forEach((line, index) => {
                line = line.trim();
                if (!line) return;

                let match;
                let key = null;
                let countStr = null;
                let parseSuccess = false;

                if (formatType === 'cc') {
                    match = line.match(ccRegex);
                    if (match) { key = match[1]; countStr = match[2].replace(/,/g, ''); parseSuccess = true; }
                } else if (formatType === 'ftp') {
                    match = line.match(ftpRegex);
                    if (match) { key = match[1]; countStr = match[2]; parseSuccess = true; }
                }

                if (parseSuccess && key && countStr !== null) {
                    const count = parseInt(countStr, 10);
                    if (!isNaN(count)) {
                        data[key] = count;
                    } else {
                         console.warn(`Line ${index + 1}: Could not parse count for key "${key}" from string "${countStr}" in line: "${line}"`);
                    }
                } else {
                    console.warn(`Line ${index + 1}: FAILED to parse using ${formatType.toUpperCase()} format: "${line}"`);
                }
            });

            console.log("Normalizing keys for output consistency...");
            if (data["TPMAIN"] !== undefined && data["TPMain"] === undefined) {
                data["TPMain"] = data["TPMAIN"]; delete data["TPMAIN"];
            }
            if (data["7TGraham"] !== undefined && data["7Theresa"] === undefined) {
                data["7Theresa"] = data["7TGraham"]; delete data["7TGraham"];
            } else if (data["7TGraham"] !== undefined && data["7Theresa"] !== undefined) {
                 delete data["7TGraham"];
            }
            if (data["4HomeShowOTH"] !== undefined && data["4HomeShowOther"] === undefined) {
                data["4HomeShowOther"] = data["4HomeShowOTH"]; delete data["4HomeShowOTH"];
            } else if (data["4HomeShowOTH"] !== undefined && data["4HomeShowOther"] !== undefined) {
                 delete data["4HomeShowOTH"];
            }
            if (data["7OtherBenefits"] !== undefined && data["7Other-Benefits"] === undefined) {
                data["7Other-Benefits"] = data["7OtherBenefits"]; delete data["7OtherBenefits"];
            } else if (data["7OtherBenefits"] !== undefined && data["7Other-Benefits"] !== undefined) {
                 delete data["7OtherBenefits"];
            }
            console.log("Normalization complete. Populating tables...");

            const otherMktgSourcesOrder = [
                "1NeedsResearch", "1WalkIn", "2BNI", "2CoT", "2GeneralAdsOther",
                "2OtherBenefits", "2OtherEvents", "2OtherNetworking", "2OtherNonProfit",
                "2ShipTourEvent", "2SocialMedia", "2VacayPerks", "3AlumniPastPrg",
                "4AirportEUG", "4AirportMFR", "4CruiseClick", "4CruiseNightEvent",
                "4HomeShowEUG", "4HomeShowOther", "4InternalOld", "4InternetNonProgram",
                "4ORContempTheatre", "4OtherEvents", "4OtherNetworking", "4OtherNonProfit",
                "4TheShedd", "4TUNNAA", "4TVRadio", "4WordofMouth", "5BrellaProductions",
                "7ACurtis", "7CDenley", "7DSoben", "7EButler", "7Gary", "7KLawson",
                "7MBunner", "7MMeyi", "7Other-Benefits", "7PastEmployee", "7RPirwitz",
                "7RyanTaylor", "7Theresa", "8CherylRosen", "8FormerAssoc",
                "8NealAlyseTMGHandles", "8SKevins", "9InternalOld", "9OtherBenefits",
                "9Siemens", "9HQ", "TPMain"
            ];

            const mainMktgMap = [
                 { label: "AMAC",                 key: "1AMAC" }, { label: "Bells of the Cascades",key: "4BellsoftheCascades" },
                 { label: "CCNY",                 key: "3CityCollegeNYCCNY" }, { label: "Dlindberg",            key: "8DLindberg" },
                 { label: "Dmenkhaus",            key: "8DMenkhaus" }, { label: "FOP",                  key: "2FOP" },
                 { label: "Hcosta",               key: "8HCosta" }, { label: "LaneLeaders",          key: "1LaneLead" },
                 { label: "LifeBalance",          key: "1LifeBalance" }, { label: "Lnanakul",             key: "8LNanakul" },
                 { label: "MyEdDiscount",         key: "1MyEdDiscount" }, { label: "NPN",                  key: "4NPN" },
                 { label: "Oregon State",         key: "3OregonStateORST" }, { label: "Passport",             key: "1Passport" },
                 { label: "PGI",                  key: "2ProctorGallagher" }, { label: "PollinGroup",          key: "4Pollin" },
                 { label: "Rpunch",               key: "8RPunch" }, { label: "Shepherd Univ AA",     key: "3ShepherdUAASUAA" },
                 { label: "AlyseNeal",            key: "8AlyseNeal" }, { label: "UTSA",                 key: "3UTSanAntonioUTSA" },
                 { label: "WOAR",                 key: "2WOAR" }, { label: "YouDecide",            key: "1YouDecide" }
            ];

            const otherMktgTbody = document.querySelector('#otherMktgTable tbody');
            otherMktgTbody.innerHTML = '';
            otherMktgSourcesOrder.forEach(sourceKey => {
                const count = data[sourceKey] !== undefined ? data[sourceKey] : 0;
                if (data[sourceKey] === undefined) {
                     console.log(`   Lookup for "${sourceKey}" in final data failed (count set to 0).`);
                 }
                const row = document.createElement('tr');
                row.innerHTML = `<td>${sourceKey}</td><td>${count}</td>`;
                otherMktgTbody.appendChild(row);
            });

            const mainMktgTbody = document.querySelector('#mainMktgTable tbody');
            mainMktgTbody.innerHTML = '';
            mainMktgMap.forEach(item => {
                const count = data[item.key] !== undefined ? data[item.key] : 0;
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.label}</td><td>${count}</td>`;
                mainMktgTbody.appendChild(row);
            });
            console.log("Processing finished.");
        }

        function copyTableToClipboard(tableId, buttonElement) {
            const table = document.getElementById(tableId);
            if (!table) {
                console.error("Table not found:", tableId);
                return;
            }

            let dataString = "";
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowData = Array.from(cells).map(cell => cell.innerText);
                dataString += rowData.join('\t') + '\n'; // Tab-separated values
            });

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(dataString.trim()).then(() => {
                    console.log(`Table ${tableId} copied to clipboard!`);
                    const originalText = buttonElement.innerText;
                    buttonElement.innerText = 'Copied!';
                    setTimeout(() => {
                        buttonElement.innerText = originalText;
                    }, 2000); // Revert button text after 2 seconds
                }).catch(err => {
                    console.error('Failed to copy table to clipboard: ', err);
                    alert('Failed to copy. See console for details.');
                });
            } else {
                console.error('Clipboard API not available.');
                alert('Clipboard API not available in your browser.');
            }
        }
    </script>

</body>
</html>